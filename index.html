<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cirurgias HC - Formulário Eletivo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3f37c9;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --border-color: #e0e0e0;
            --success-color: #4cc9f0;
            --danger-color: #f72585;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8f9fa;
            color: #212529;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin: 2rem auto;
        }

        h1 {
            color: #4361ee;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: left;
            font-size: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-section {
            margin-bottom: 2.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }

        .form-title {
            color: #3f37c9;
            font-weight: 500;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
        }

        .form-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .form-control, .form-select {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            font-size: 0.9rem;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-top: 0.5rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: #4361ee;
            border: none;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            border-radius: 8px;
        }

        .btn-secondary {
            background-color: transparent;
            border: 1px solid #e0e0e0;
            padding: 0.75rem 1.5rem;
            font-weight: 500;
            border-radius: 8px;
        }

        .form-check-input:checked {
            background-color: #4361ee;
            border-color: #4361ee;
        }

        @media (max-width: 768px) {
            .container {
                padding: 1.5rem;
                margin: 1rem;
            }
            
            h1 {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cirurgias HC - Aviso de Cirurgia Eletiva</h1>
        
        <div class="form-section">
            <h3 class="form-title">Dados da Cirurgia</h3>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="dataCirurgia" class="form-label">Data da Cirurgia</label>
                    <input type="date" class="form-control" id="dataCirurgia">
                </div>
                <div class="col-md-3">
                    <label for="horario" class="form-label">Horário</label>
                    <input type="time" class="form-control" id="horario">
                </div>
                <div class="col-md-3">
                    <label for="prontuario" class="form-label">Prontuário</label>
                    <input type="text" class="form-control" id="prontuario">
                </div>
            </div>
            
            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <label for="nomeCliente" class="form-label">Nome do Cliente</label>
                    <input type="text" class="form-control" id="nomeCliente">
                </div>
                <div class="col-md-2">
                    <label for="idade" class="form-label">Idade</label>
                    <input type="text" class="form-control" id="idade">
                </div>
                <div class="col-md-2">
                    <label for="peso" class="form-label">Peso</label>
                    <input type="text" class="form-control" id="peso">
                </div>
                <div class="col-md-2">
                    <label class="form-label">Sexo</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="sexo" id="feminino" value="F">
                            <label class="form-check-label" for="feminino">F</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="sexo" id="masculino" value="M">
                            <label class="form-check-label" for="masculino">M</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <label for="nomeMae" class="form-label">Nome da Mãe</label>
                    <input type="text" class="form-control" id="nomeMae">
                </div>
                <div class="col-md-3">
                    <label for="dataNascimento" class="form-label">Data de Nascimento</label>
                    <input type="date" class="form-control" id="dataNascimento">
                </div>
                <div class="col-md-3">
                    <label for="clinica" class="form-label">Clínica</label>
                    <input type="text" class="form-control" id="clinica">
                </div>
            </div>
        </div>
        
        <div class="form-section">
            <h3 class="form-title">Informações Clínicas</h3>
            <div class="row g-3">
                <div class="col-md-3">
                    <label for="leito" class="form-label">Leito</label>
                    <input type="text" class="form-control" id="leito">
                </div>
                <div class="col-md-3">
                    <label for="especialidade" class="form-label">Especialidade</label>
                    <input type="text" class="form-control" id="especialidade">
                </div>
                <div class="col-md-6">
                    <label class="form-label">Estado geral</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="estadoGeral" id="bom" value="Bom">
                            <label class="form-check-label" for="bom">Bom</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="estadoGeral" id="regular" value="Regular">
                            <label class="form-check-label" for="regular">Regular</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="estadoGeral" id="grave" value="Grave">
                            <label class="form-check-label" for="grave">Grave</label>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row g-3 mt-3">
                <div class="col-md-6">
                    <label for="diagnostico" class="form-label">Diagnóstico</label>
                    <input type="text" class="form-control" id="diagnostico">
                </div>
                <div class="col-md-6">
                    <label for="cid" class="form-label">CID</label>
                    <input type="text" class="form-control" id="cid">
                </div>
            </div>
            
            <div class="row g-3 mt-3">
                <div class="col-md-12">
                    <label for="cirurgiaProposta" class="form-label">Cirurgia Proposta</label>
                    <input type="text" class="form-control" id="cirurgiaProposta">
                </div>
            </div>
            
            <div class="row g-3 mt-3">
                <div class="col-md-3">
                    <label for="duracao" class="form-label">Duração estimada</label>
                    <input type="text" class="form-control" id="duracao">
                </div>
                <div class="col-md-3">
                    <label class="form-label">Cirurgia Oncológica</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="oncologica" id="oncologicaSim" value="SIM">
                            <label class="form-check-label" for="oncologicaSim">SIM</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="oncologica" id="oncologicaNao" value="NÃO">
                            <label class="form-check-label" for="oncologicaNao">NÃO</label>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <label class="form-label">Potencial de contaminação</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="contaminacao" id="limpa" value="Limpa">
                            <label class="form-check-label" for="limpa">Limpa</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="contaminacao" id="contaminada" value="Contaminada">
                            <label class="form-check-label" for="contaminada">Contaminada</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="contaminacao" id="potencialmenteContaminada" value="Potencialmente Contaminada">
                            <label class="form-check-label" for="potencialmenteContaminada">Pot. Contaminada</label>
                        </div>
                        <div class="checkbox-item">
                            <input class="form-check-input" type="radio" name="contaminacao" id="infectante" value="Infectante">
                            <label class="form-check-label" for="infectante">Infectante</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Restante do formulário (equipe cirúrgica, materiais, etc) -->
        <!-- ... (mantido igual ao código anterior) ... -->
        
        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
            <button class="btn btn-primary me-md-2" type="button" id="gerar-pdf">Gerar PDF</button>
            <button class="btn btn-secondary" type="button" id="limpar-form">Limpar Formulário</button>
        </div>
        
        <div class="mt-4 alert alert-info">
            <strong>Importante:</strong> Você precisará carregar o modelo PDF original para que o sistema possa preenchê-lo.
            <input type="file" id="pdf-template" class="form-control mt-2" accept=".pdf">
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Variável para armazenar o PDF carregado
        let pdfBytes = null;
        
        // Carregar o template PDF
        document.getElementById('pdf-template').addEventListener('change', async function(e) {
            const file = e.target.files[0];
            if (file) {
                const arrayBuffer = await file.arrayBuffer();
                pdfBytes = new Uint8Array(arrayBuffer);
                alert('Modelo PDF carregado com sucesso! Agora você pode preencher o formulário.');
            }
        });
        
        // Limpar formulário
        document.getElementById('limpar-form').addEventListener('click', () => {
            const formElements = document.querySelectorAll('input, textarea, select');
            formElements.forEach(element => {
                if (element.type === 'radio' || element.type === 'checkbox') {
                    element.checked = false;
                } else if (element.type !== 'file') {
                    element.value = '';
                }
            });
        });
        
        // Gerar PDF preenchido
        document.getElementById('gerar-pdf').addEventListener('click', async () => {
            if (!pdfBytes) {
                alert('Por favor, carregue primeiro o modelo PDF original.');
                return;
            }
            
            try {
                const { PDFDocument, rgb } = PDFLib;
                const pdfDoc = await PDFDocument.load(pdfBytes);
                const form = pdfDoc.getForm();
                
                // Obter todos os valores do formulário HTML
                const formData = {
                    dataCirurgia: document.getElementById('dataCirurgia').value,
                    horario: document.getElementById('horario').value,
                    prontuario: document.getElementById('prontuario').value,
                    nomeCliente: document.getElementById('nomeCliente').value,
                    idade: document.getElementById('idade').value,
                    peso: document.getElementById('peso').value,
                    sexo: document.querySelector('input[name="sexo"]:checked')?.value || '',
                    nomeMae: document.getElementById('nomeMae').value,
                    dataNascimento: document.getElementById('dataNascimento').value,
                    clinica: document.getElementById('clinica').value,
                    leito: document.getElementById('leito').value,
                    especialidade: document.getElementById('especialidade').value,
                    estadoGeral: document.querySelector('input[name="estadoGeral"]:checked')?.value || '',
                    diagnostico: document.getElementById('diagnostico').value,
                    cid: document.getElementById('cid').value,
                    cirurgiaProposta: document.getElementById('cirurgiaProposta').value,
                    duracao: document.getElementById('duracao').value,
                    oncologica: document.querySelector('input[name="oncologica"]:checked')?.value || '',
                    contaminacao: document.querySelector('input[name="contaminacao"]:checked')?.value || '',
                    // ... (adicionar todos os outros campos)
                };
                
                // Mapear campos do PDF e preencher com os dados do formulário
                // NOTA: Você precisará ajustar os nomes dos campos conforme o seu PDF real
                const fieldMappings = {
                    'Data da Cirurgia': formData.dataCirurgia,
                    'Horário': formData.horario,
                    'Prontuário': formData.prontuario,
                    'Nome do Cliente': formData.nomeCliente,
                    'Idade': formData.idade,
                    'Peso': formData.peso,
                    'Sexo': formData.sexo,
                    'Nome da Mãe': formData.nomeMae,
                    'Data de Nascimento': formData.dataNascimento,
                    'Clínica': formData.clinica,
                    'Leito': formData.leito,
                    'Especialidade': formData.especialidade,
                    'Estado geral do Cliente': formData.estadoGeral,
                    'Diagnóstico': formData.diagnostico,
                    'CID': formData.cid,
                    'Cirurgia Proposta': formData.cirurgiaProposta,
                    'Duração estimada': formData.duracao,
                    'CIRURGIA ONCOLÓGICA': formData.oncologica,
                    'Potencial de contaminação da cirurgia': formData.contaminacao,
                    // ... (mapear todos os outros campos)
                };
                
                // Preencher os campos do PDF
                const fields = form.getFields();
                fields.forEach(field => {
                    const fieldName = field.getName();
                    if (fieldMappings[fieldName]) {
                        const value = fieldMappings[fieldName];
                        if (field instanceof PDFLib.PDFRadioGroup) {
                            field.select(value);
                        } else if (field instanceof PDFLib.PDFCheckBox) {
                            value ? field.check() : field.uncheck();
                        } else {
                            field.setText(value);
                        }
                    }
                });
                
                // Salvar o PDF preenchido
                const pdfBytesFilled = await pdfDoc.save();
                const blob = new Blob([pdfBytesFilled], { type: 'application/pdf' });
                saveAs(blob, 'Cirurgia_Eletiva_Preenchida.pdf');
                
            } catch (error) {
                console.error('Erro ao gerar PDF:', error);
                alert('Ocorreu um erro ao gerar o PDF. Verifique o console para mais detalhes.');
            }
        });
    </script>
</body>
</html>
